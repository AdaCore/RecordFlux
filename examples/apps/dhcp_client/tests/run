#!/bin/bash

set -x

dnsmasq --no-daemon --dhcp-leasefile=obj/dnsmasq.leases --port=1053 --dhcp-alternate-port --conf-file=$(dirname "$(realpath $0)")/dnsmasq.conf &
DNSMASQ_PID=$!

sleep 2
timeout 5 obj/dhcp_client | tee /dev/tty | grep -q Success
SUCCESS=$?

kill -9 $DNSMASQ_PID
exit $SUCCESS

trap "kill -9 $DNSMASQ_PID" SIGINT SIGTERM EXIT

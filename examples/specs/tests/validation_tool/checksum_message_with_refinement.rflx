with Checksum_Message;
with Message_No_Checksum;

package Checksum_Message_With_Refinement is

   type Field_A is
      (Refinement_Message_With_Checksum => 1,
       Refinement_Message_Without_Checksum => 2)
    with Size => 8;
   type Checksum is mod 2**8;

   type Message is
      message
         Field_A : Field_A;
         Payload : Opaque
            with Size => 24;
         Checksum : Checksum
            then null
               if Checksum'Valid_Checksum;
      end message with
         Checksum => (Checksum => (Field_A'First .. Field_B'Last, Checksum'Size));

   for Message use (Payload => Checksum_Message::Message)
      if Field_A = Refinement_Message_With_Checksum;

  for Message use (Payload => Message_No_Checksum::Message)
      if Field_A = Refinement_Message_Without_Checksum;

end Checksum_Message_With_Refinement;

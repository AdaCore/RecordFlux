with "aunit";
with "defaults";

project Test is

   type Flag_Type is ("yes", "no");
   AUnit : Flag_Type := external ("aunit", "yes");
   Optimization : Flag_Type := external ("optimization", "no");

   Spec_Dir := "examples/specs";
   Test_Dir := "tests/spark";
   Generated_Dir := "tests/spark/generated";

   for Languages use ("Ada", "RecordFlux");

   package Compiler is
      for Driver ("RecordFlux") use "";
   end Compiler;

   package Naming is
      for Spec_Suffix ("RecordFlux") use ".rflx";
   end Naming;

   package RecordFlux is
      for Output_Dir use Generated_Dir;
   end RecordFlux;

   case AUnit is
      when "yes" =>
         for Source_Dirs use (Test_Dir, Generated_Dir, Spec_Dir);
         for Main use ("test.adb");
      when "no" =>
         for Source_Dirs use (Generated_Dir, Spec_Dir);
   end case;

   for Object_Dir use "build";
   for Create_Missing_Dirs use "True";

   package Builder is
      case Optimization is
         when "yes" =>
            for Default_Switches ("Ada") use Defaults.Builder_Switches & ("-O3");
         when "no" =>
            for Default_Switches ("Ada") use Defaults.Builder_Switches & Defaults.Compiler_Switches;
      end case;
   end Builder;

   package Binder is
      for Default_Switches ("Ada") use Defaults.Binder_Switches;
   end Binder;

   package Prove is
      for Proof_Switches ("Ada") use Defaults.Proof_Switches;

      --  Improving proof time
      for Proof_Switches ("rflx-arrays-av_enumeration_vector.ads") use ("--prover=Z3", "--steps=683");
      for Proof_Switches ("rflx-arrays-enumeration_vector.ads") use ("--prover=Z3", "--steps=247");
      for Proof_Switches ("rflx-arrays-inner_message.ads") use ("--prover=Z3", "--steps=338");
      for Proof_Switches ("rflx-arrays-inner_messages.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-arrays-message.ads") use ("--prover=CVC4,Z3", "--steps=979");
      for Proof_Switches ("rflx-arrays-messages_message.ads") use ("--prover=CVC4,Z3", "--steps=633");
      for Proof_Switches ("rflx-arrays-modular_vector.ads") use ("--prover=CVC4", "--steps=1");
      for Proof_Switches ("rflx-arrays-range_vector.ads") use ("--prover=Z3", "--steps=446");
      for Proof_Switches ("rflx-arrays-tests.adb") use ("--prover=Z3", "--steps=1768");
      for Proof_Switches ("rflx-arrays.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-builtin_types_tests.adb") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-custom_types_tests.adb") use ("--prover=altergo,CVC4", "--steps=308809");
      for Proof_Switches ("rflx-derivation-message.ads") use ("--prover=CVC4,Z3", "--steps=980");
      for Proof_Switches ("rflx-derivation-tests.adb") use ("--prover=Z3", "--steps=2215");
      for Proof_Switches ("rflx-enumeration-message.ads") use ("--prover=Z3", "--steps=359");
      for Proof_Switches ("rflx-enumeration-tests.adb") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-enumeration.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-ethernet-frame.ads") use ("--prover=Z3,CVC4", "--steps=514083");
      for Proof_Switches ("rflx-ethernet-tests.adb") use ("--prover=CVC4,Z3", "--steps=239949");
      for Proof_Switches ("rflx-ethernet.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-expression-message.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-expression-tests.adb") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-icmp-message.ads") use ("--prover=Z3", "--steps=37511");
      for Proof_Switches ("rflx-icmp.ads") use ("--prover=CVC4", "--steps=1");
      for Proof_Switches ("rflx-in_ethernet-contains.ads") use ("--prover=CVC4,Z3", "--steps=514");
      for Proof_Switches ("rflx-in_ethernet-tests.adb") use ("--prover=Z3", "--steps=127610");
      for Proof_Switches ("rflx-in_ipv4-contains.ads") use ("--prover=CVC4,Z3", "--steps=4900");
      for Proof_Switches ("rflx-in_ipv4-tests.adb") use ("--prover=Z3,altergo,CVC4", "--steps=168505");
      for Proof_Switches ("rflx-in_tlv-tests.adb") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-ipv4-option.ads") use ("--prover=CVC4", "--steps=1920");
      for Proof_Switches ("rflx-ipv4-options.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-ipv4-packet.ads") use ("--prover=CVC4,Z3", "--steps=29059");
      for Proof_Switches ("rflx-ipv4-tests.adb") use ("--prover=Z3", "--steps=92233");
      for Proof_Switches ("rflx-ipv4.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-rflx_arithmetic.adb") use ("--prover=CVC4", "--steps=70979");
      for Proof_Switches ("rflx-rflx_types.ads") use ("--prover=altergo,CVC4", "--steps=239854");
      for Proof_Switches ("rflx-tlv-message.ads") use ("--prover=CVC4,Z3", "--steps=85");
      for Proof_Switches ("rflx-tlv-tests.adb") use ("--prover=Z3", "--steps=467");
      for Proof_Switches ("rflx-tlv.ads") use ("--prover=Z3", "--steps=1");
      for Proof_Switches ("rflx-udp-datagram.ads") use ("--prover=CVC4,Z3", "--steps=2334");
      for Proof_Switches ("rflx-udp.ads") use ("--prover=Z3", "--steps=1");
   end Prove;

end Test;

--  error: dependency cycle
with Multiple_Errors;

--  error: RFLX prefix not allowed
--  error: Package identifier inconsistent with file name
package RFLX_Invalid is

   type R is range 5 .. 23 with Size => 16;
   type R_Array is array of R;

   --  error: first contains variable
   --  error: last contains variable
   type Range2 is range X + 2 .. X + 55 with Size => 24;

   --  error: range negative
   type Range3 is range 100 .. 50 with Size => 24;

   --  error: size contains variable negative
   type Range4 is range 1 .. 50 with Size => 24 + T;

   --  error: size too small
   type Range5 is range 0 .. 255 with Size => 7;

   --  error: undefined element type
   type A2 is array of Undef;

   --  error: Modular type exceeds limit
   type S is mod 2**128;

   --  error: Modular type is not base 2
   type T is mod 1023;

   --  error: Modulus contains variable
   type Mod3 is mod 2**Value;

   --  error: Duplicate type
   type R is (R_E1, R_E2) with Size => 8;

   --  error: Redefinition of built-in type
   type Boolean is (Foo, Bar) with Size => 12;

   --  error: Conflicting literals
   type R2 is (R2_E1, R2_E2, Foo) with Size => 24;

   --  error: Size too small
   --  error: Duplicate element
   type E2 is (E2_1, E2_2, E2_2) with Size => 1;

   -- error: duplicate enumeration value
   type E3 is (E3_1 => 1, E3_2 => 2, E3_3 => 2) with Size => 8;

   -- error: conflicting literals
   type E4 is (True, False) with Size => 1;

   -- error: conflict between type and literals
   type E5 is (Foo, E4, Bar) with Size => 8;

   type M1 is
      message
         null
            then X
               with Length => 2 * 8;
         -- error: Aggregate element out of range (2 times)
         X : Opaque
            then Y
               with Length => 5 * 8
                  if X = (1, 256, 20, 500);
         -- error: Aggregate element out of range (3 times)
         Y : R_Array
            then null if Y = (1, 10, 20, 50, 60);
      end message;

   type M2 is
      message
         -- error: Undefined component type
         Z : Undef_Type
            -- error: Undefined component
            then X;
      end message;

   -- error: unsupported element type size
   type E6 is mod 2**4;
   type A3 is array of E6;

   type SDU1 is
      message
         Field : Boolean
            then null
               --  error: invalid first expression
               with First => 0;
      end message;

   type SDU2 is
      message
         Field : Boolean;
      end message;

   type PDU1 is
      message
         Length : R then Data with Length => Length;
         Data : Opaque;
      end message;
   for RFLX_Invalid.PDU1 use (Data => RFLX_Invalid.SDU1);

   -- FIXME: Not detected
   -- error: duplicate refinement
   for PDU1 use (Data => SDU2);

   -- error: undefined message
   for Undef_PDU use (Data => R);

   -- error: undefined type in refinement
   for PDU1 use (Data => Undef_Type);

   -- error: invalid field
   for PDU1 use (Undef_Field => R)
   -- error: unknown field or literal X in condition
   -- error: unknown field or literal Y in condition
      if X < Y + 1;

   -- error: duplicate refinement
   type Ref1 is new PDU1;
   type Ref1 is new PDU1;

   -- error: undefined base message
   type Ref2 is new Undef_Type;

   -- error: illegal derivation non-message type
   type Ref3 is new R;

   -- error: illegal derivation of derived type
   type Ref4 is new Ref1;

--  error: End identifier inconsistent with package identifier
end Inconsistent;

with Universal;

package Test is

   generic
      Channel : Channel with Readable, Writable;  --  §S-P-C-RW
   session Session with
      Initial => Start,
      Final => Terminated
   is
      Message : Universal::Message;  --  §S-D-V-T-M, §S-D-V-E-N
   begin
      state Start is
      begin
      transition
         goto Reply
            if Channel'Has_Data  --  §S-S-T-HDAT, §S-E-AT-HD-V
         goto Terminated  --  §S-S-T-N
      end Start;

      state Reply is
      begin
         Channel'Read (Message);  --  §S-S-A-RD-V
         Channel'Write (Message);  --  §S-S-A-WR-V
      transition
         goto Start  --  §S-S-T-N
      exception
         goto Terminated  --  §S-S-E
      end Reply;

      state Terminated is null state;  --  §S-S-N
   end Session;

end Test;
